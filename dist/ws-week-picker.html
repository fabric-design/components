<!-- inject:global -->
<!-- endinject -->
<template>
    <div class="ws-week-picker">
        <!-- inject:html -->
        <div class="ws-week-wrapper">
  <input type="text" class="ws-week-input" readonly placeholder="week picker" /> <i class="icon icon-calendar"></i>
  <div class="ws-week-picker-calendar">
    <div class="year-selector prev-year">
      <span class="icon checkPrevYear"></span>
      <div class="year"></div>
      <div class="weeks"></div>
    </div>
    <div class="year-selector cur-year">
      <div class="year"></div>
      <div class="weeks"></div>
    </div>
    <div class="year-selector next-year">
      <div class="year"></div>
      <span class="icon checkNextYear"></span>
      <div class="weeks"></div>
    </div>
  </div>
</div>

        <!-- endinject -->
    </div>
    <style>
        ws-week-picker > .light-dom {
            display: none;
        }
        /* inject:styles */
        @charset "UTF-8";

@font-face {
  font-family: "fontello";
  src: url("icons/font/fontello.eot?4287725");
  src: url("icons/font/fontello.eot?4287725#iefix") format("embedded-opentype"), url("icons/font/fontello.woff2?4287725") format("woff2"), url("icons/font/fontello.woff?4287725") format("woff"), url("icons/font/fontello.ttf?4287725") format("truetype"), url("icons/font/fontello.svg?4287725#fontello") format("svg");
  font-weight: normal;
  font-style: normal;
}

.ws-week-picker .icon, .ws-week-picker [class^="icon-"], .ws-week-picker [class*=" icon-"] {
  line-height: 1rem;
}

.ws-week-picker .icon:before, .ws-week-picker [class^="icon-"]:before, .ws-week-picker [class*=" icon-"]:before {
  font-family: "fontello";
  font-style: normal;
  font-weight: normal;
  speak: none;
  display: inline-block;
  text-decoration: inherit;
  text-align: center;
  font-variant: normal;
  text-transform: none;
  font-size: 150%;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.ws-week-picker .icon16 {
  width: rem(16px);
  height: rem(16px);
  line-height: rem(16px);
  font-size: rem(16px);
  text-indent: -2px;
}

.ws-week-picker .icon24 {
  width: rem(24px);
  height: rem(24px);
  line-height: rem(24px);
  font-size: rem(24px);
  text-indent: -3px;
}

.ws-week-picker .icon32 {
  width: rem(32px);
  height: rem(32px);
  line-height: rem(32px);
  font-size: rem(32px);
  text-indent: -4px;
}

.ws-week-picker .icon48 {
  width: rem(48px);
  height: rem(48px);
  line-height: rem(48px);
  font-size: rem(48px);
  text-indent: -5px;
}

.ws-week-picker .icon-cross:before {
  content: "";
}

.ws-week-picker .icon-calendar:before {
  content: "";
}

/**
     * Spinner with zalando icon
     * Example: <span class="icon-zalando spinner"><span></span></span>
     */

@keyframes animateRightBall {
  .ws-week-picker 0% {
    transform: translate3d(0, 0, 0);
  }

  .ws-week-picker 50% {
    transform: translate3d(1.5em, 0, 0);
  }

  .ws-week-picker 0% {
    transform: translate3d(0, 0, 0);
  }
}

@keyframes animateLeftBall {
  .ws-week-picker 0% {
    transform: translate3d(0, 0, 0);
  }

  .ws-week-picker 50% {
    transform: translate3d(-1.5em, 0, 0);
  }

  .ws-week-picker 0% {
    transform: translate3d(0, 0, 0);
  }
}

.ws-week-picker input {
  display: block;
  font-family: "acumin-pro", "Helvetica Neue", Helvetica, Arial, sans-serif;
  font-size: 1rem;
}

.ws-week-picker input:not([type]), .ws-week-picker input[type=text], .ws-week-picker input[type=url], .ws-week-picker input[type=password], .ws-week-picker input[type=tel], .ws-week-picker input[type=number], .ws-week-picker input[type=color], .ws-week-picker input[type=email] {
  padding: rem(8px);
  border: 1px solid #BDBFC7;
  box-shadow: inset 0px 1px 3px 0px #e6e7ea;
  box-sizing: border-box;
  outline: none;
  background-color: #FFFFFF;
  height: rem(34px);
  font-weight: normal;
  transition: border-color .2s linear, box-shadow .2s linear;
}

.ws-week-picker input:not([type]):focus, .ws-week-picker input[type=text]:focus, .ws-week-picker input[type=url]:focus, .ws-week-picker input[type=password]:focus, .ws-week-picker input[type=tel]:focus, .ws-week-picker input[type=number]:focus, .ws-week-picker input[type=color]:focus, .ws-week-picker input[type=email]:focus {
  border-color: #008DC9;
  box-shadow: inset 0 1px 3px 0px #96e0ff;
}

.ws-week-picker input:not([type]):disabled, .ws-week-picker input[type=text]:disabled, .ws-week-picker input[type=url]:disabled, .ws-week-picker input[type=password]:disabled, .ws-week-picker input[type=tel]:disabled, .ws-week-picker input[type=number]:disabled, .ws-week-picker input[type=color]:disabled, .ws-week-picker input[type=email]:disabled {
  background-color: #F5F6F9;
}

.ws-week-picker .input-wrapper {
  position: relative;
}

.ws-week-picker .input-wrapper .icon {
  position: absolute;
  top: 10px;
  right: 8px;
}

.ws-week-picker input[type="search"] {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
}

.ws-week-picker input[type="checkbox"], .ws-week-picker input[type="radio"] {
  margin-right: 0.34375rem;
}

.ws-week-picker input[type="file"] {
  padding-bottom: 0.6875rem;
  width: 100%;
}

/**
 * Parse a numeric value from a string
 */

/**
 * Convert a pixel value to rem
 */

/**
 * Convert a list of pixel values to rem values
 */

/**
* Z-index function for managing the values
*/

.ws-week-picker .ws-week-wrapper {
  display: inline-block;
  position: relative;
}

.ws-week-picker .ws-week-wrapper > #ws-week-icon {
  right: 11px;
  top: 8px;
  position: absolute;
  width: 16px;
  height: 16px;
}

.ws-week-picker .ws-week-wrapper > input {
  padding: 0.5rem;
  border: 1px solid #BDBFC7;
  box-shadow: inset 0px 1px 3px 0px #e6e7ea;
  box-sizing: border-box;
  outline: none;
  background-color: #FFFFFF;
  height: 2.125rem;
  font-weight: normal;
  transition: border-color .2s linear, box-shadow .2s linear;
  font-family: inherit;
  color: inherit;
  width: 100%;
}

.ws-week-picker .ws-week-wrapper > input:focus {
  border-color: #008DC9;
  box-shadow: inset 0 1px 3px 0px #96e0ff;
}

.ws-week-picker .ws-week-wrapper > input:disabled {
  background-color: #F5F6F9;
}

.ws-week-picker .ws-week-wrapper > input + .icon {
  width: 16px;
  height: 16px;
  right: 11px;
  top: 8px;
  position: absolute;
}

.ws-week-picker .ws-week-wrapper > .ws-week-picker-calendar {
  padding: 13px 0;
  top: 40px;
  width: 596px;
  height: 258px;
  padding-bottom: 19px;
  background-color: #FFFFFF;
  position: absolute;
  display: none;
  box-shadow: 2px 3px 28px 3px #b8b8b8;
  z-index: 8000;
}

.ws-week-picker .ws-week-wrapper > .ws-week-picker-calendar.opened {
  display: block;
}

.ws-week-picker .ws-week-wrapper > .ws-week-picker-calendar > .year-selector {
  display: inline-block;
}

.ws-week-picker .ws-week-wrapper > .ws-week-picker-calendar > .year-selector > .icon {
  margin-top: 0.375rem;
  height: 0.75rem;
  width: 0.75rem;
}

.ws-week-picker .ws-week-wrapper > .ws-week-picker-calendar > .year-selector > .icon[disabled] {
  visibility: hidden;
}

.ws-week-picker .ws-week-wrapper > .ws-week-picker-calendar > .year-selector > .year {
  color: #CBCDD5;
  font-weight: 600;
  padding-bottom: 13px;
}

.ws-week-picker .ws-week-wrapper > .ws-week-picker-calendar > .year-selector.prev-year {
  width: 85px;
  display: inline-block;
}

.ws-week-picker .ws-week-wrapper > .ws-week-picker-calendar > .year-selector.prev-year > .checkPrevYear {
  float: left;
  margin-left: 18px;
  background: url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxMjkgMTI5IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAxMjkgMTI5IiB3aWR0aD0iMTZweCIgaGVpZ2h0PSIxNnB4Ij4KICA8Zz4KICAgIDxwYXRoIGQ9Im04OC42LDEyMS4zYzAuOCwwLjggMS44LDEuMiAyLjksMS4yczIuMS0wLjQgMi45LTEuMmMxLjYtMS42IDEuNi00LjIgMC01LjhsLTUxLTUxIDUxLTUxYzEuNi0xLjYgMS42LTQuMiAwLTUuOHMtNC4yLTEuNi01LjgsMGwtNTQsNTMuOWMtMS42LDEuNi0xLjYsNC4yIDAsNS44bDU0LDUzLjl6IiBmaWxsPSIjMDAwMDAwIi8+CiAgPC9nPgo8L3N2Zz4K) 0 -2px;
}

.ws-week-picker .ws-week-wrapper > .ws-week-picker-calendar > .year-selector.prev-year > .year {
  margin-left: 38px;
}

.ws-week-picker .ws-week-wrapper > .ws-week-picker-calendar > .year-selector.cur-year {
  width: 433px;
  margin: 0 -3px;
}

.ws-week-picker .ws-week-wrapper > .ws-week-picker-calendar > .year-selector.cur-year > .year {
  text-align: center;
}

.ws-week-picker .ws-week-wrapper > .ws-week-picker-calendar > .year-selector.next-year {
  width: 76px;
  float: right;
}

.ws-week-picker .ws-week-wrapper > .ws-week-picker-calendar > .year-selector.next-year > .checkNextYear {
  float: left;
  margin-left: -2px;
  background: url(data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxMjkgMTI5IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAxMjkgMTI5IiB3aWR0aD0iMTZweCIgaGVpZ2h0PSIxNnB4Ij4KICA8Zz4KICAgIDxwYXRoIGQ9Im00MC40LDEyMS4zYy0wLjgsMC44LTEuOCwxLjItMi45LDEuMnMtMi4xLTAuNC0yLjktMS4yYy0xLjYtMS42LTEuNi00LjIgMC01LjhsNTEtNTEtNTEtNTFjLTEuNi0xLjYtMS42LTQuMiAwLTUuOCAxLjYtMS42IDQuMi0xLjYgNS44LDBsNTMuOSw1My45YzEuNiwxLjYgMS42LDQuMiAwLDUuOGwtNTMuOSw1My45eiIgZmlsbD0iIzAwMDAwMCIvPgogIDwvZz4KPC9zdmc+Cg==) 0 -2px;
}

.ws-week-picker .ws-week-wrapper > .ws-week-picker-calendar > .year-selector.next-year > .year {
  float: left;
  margin-left: 13px;
  padding-right: 6px;
}

.ws-week-picker .ws-week-wrapper > .ws-week-picker-calendar > .cur-year > .weeks, .ws-week-picker .ws-week-wrapper > .ws-week-picker-calendar > .next-year > .weeks {
  margin-left: -5px;
}

.ws-week-picker .ws-week-wrapper > .ws-week-picker-calendar .month {
  box-sizing: border-box;
  color: #CBCDD5;
  display: inline-block;
  width: 40px;
  height: 40px;
  padding-left: 5px;
  line-height: 39px;
  text-align: center;
  margin-left: 1px;
  margin-bottom: 4px;
  background-color: #DEF5FE;
}

.ws-week-picker .ws-week-wrapper > .ws-week-picker-calendar .weeks > .weekNumbers:last-child > .month {
  padding-left: 0;
  width: 45px;
}

.ws-week-picker .ws-week-wrapper > .ws-week-picker-calendar .weekNumbers {
  width: 35.3px;
  height: 35.3px;
  float: left;
  font-size: 14px;
}

.ws-week-picker .ws-week-wrapper > .ws-week-picker-calendar .week {
  background: 0 0;
  border: 1px solid transparent;
  border-radius: 150px;
  box-sizing: border-box;
  color: #393939;
  cursor: pointer;
  display: inline-block;
  width: 32px;
  height: 32px;
  line-height: 31px;
  text-align: center;
  margin: 3px 6px;
}

.ws-week-picker .ws-week-wrapper > .ws-week-picker-calendar .week.now, .ws-week-picker .ws-week-wrapper > .ws-week-picker-calendar .week.now:hover {
  background-color: #008DC9;
  color: #FFFFFF;
}

.ws-week-picker .ws-week-wrapper > .ws-week-picker-calendar .week:hover {
  background-color: #DEF5FE;
}

.ws-week-picker .ws-week-wrapper > .ws-week-picker-calendar .week[disabled] {
  color: #BDBFC7;
  background-color: #E9EAEF;
  cursor: not-allowed;
}
        /* endinject */
    </style>
</template>

<script>
(function(){
    /* inject:js */
    'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

//Get the contents of the template (_currentScript is available with webcomponents.js, use currentScript if you don't use this Polyfill)
var currentScript = document._currentScript || document.currentScript;
var template = currentScript.ownerDocument.querySelector('template');

var WSWeekPicker = function (_HTMLElement) {
  _inherits(WSWeekPicker, _HTMLElement);

  function WSWeekPicker() {
    _classCallCheck(this, WSWeekPicker);

    return _possibleConstructorReturn(this, (WSWeekPicker.__proto__ || Object.getPrototypeOf(WSWeekPicker)).apply(this, arguments));
  }

  _createClass(WSWeekPicker, [{
    key: 'createdCallback',
    value: function createdCallback() {
      // Take all main DOM elements
      var clone = document.importNode(template.content, true);
      // this.appendChild(clone);
      applyTemplate(this, clone);
      this.open = false;
      this.months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      this.getAttributes();
      this.getElements();
      this.addListeners();
      this.setInputValue();
    }

    // Take all elements from week picker

  }, {
    key: 'getElements',
    value: function getElements() {
      this.wrapper = this.querySelector('.ws-week-wrapper');
      this.input = this.querySelector('.ws-week-input');
      this.calendar = this.querySelector('.ws-week-picker-calendar');
      this.crossIcon = this.querySelector('input + i');
      this.prevYearButton = this.querySelector('.checkPrevYear');
      this.nextYearButton = this.querySelector('.checkNextYear');
      // Calculate previous year and take previous year and weeks elements
      this.prevYear = this.curYear - 1;
      this.prevYearNumber = this.querySelector('.prev-year > .year');
      this.prevYearWeeks = this.querySelector('.prev-year > .weeks');
      // Take current year and weeks elements
      this.curYearNumber = this.querySelector('.cur-year > .year');
      this.curYearWeeks = this.querySelector('.cur-year > .weeks');
      // Calculate next year and take next year and weeks elements
      this.nextYear = this.curYear + 1;
      this.nextYearNumber = this.querySelector('.next-year > .year');
      this.nextYearWeeks = this.querySelector('.next-year > .weeks');
    }

    // Attach all event liteners

  }, {
    key: 'addListeners',
    value: function addListeners() {
      var _this2 = this;

      document.addEventListener('click', function (e) {
        _this2.open && e.target.closest('ws-week-picker') !== _this2 ? _this2.closeWeekPicker() : null;
      });
      this.input.addEventListener('click', function (e) {
        return _this2.open ? _this2.closeWeekPicker() : _this2.openWeekPicker();
      });
      this.crossIcon.addEventListener('click', function (e) {
        return _this2.open ? _this2.closeWeekPicker() : _this2.openWeekPicker();
      });
      this.calendar.addEventListener('click', function (e) {
        return _this2.calendarClick(e);
      });
      this.prevYearButton.addEventListener('click', function () {
        if (parseDate(_this2.prevYear, _this2.prevYearWeeksNumbers[0][0]) < parseDate(_this2.minYear, _this2.minWeek)) {
          return;
        }
        _this2.moveYearBefore();
      });
      this.nextYearButton.addEventListener('click', function () {
        if (parseDate(_this2.nextYear, _this2.nextYearWeeksNumbers[1][_this2.nextYearWeeksNumbers[1].length - 1]) > parseDate(_this2.maxYear, _this2.maxWeek)) {
          return;
        }
        _this2.moveYearAfter();
      });
    }
  }, {
    key: 'calendarClick',
    value: function calendarClick(e) {
      // If user pick on week number take all elements to return result to input field and close calendar
      if (e.target.classList.contains('week')) {
        var pickedWeekYear = void 0,
            pickedWeek = parseInt(e.target.innerHTML);
        if (e.target.classList.contains('prevYear')) {
          pickedWeekYear = this.prevYear;
        } else if (e.target.classList.contains('nextYear')) {
          pickedWeekYear = this.nextYear;
        } else {
          pickedWeekYear = this.curYear;
        }

        var pickedDate = parseDate(pickedWeekYear, pickedWeek);
        if (pickedDate < parseDate(this.minYear, this.minWeek) || pickedDate > parseDate(this.maxYear, this.maxWeek)) {
          return;
        }

        this.pickedWeekWrapper.classList.remove('now');
        this.pickedWeekWrapper = e.target;
        this.pickedWeekWrapper.classList.add('now');

        this.parseDates(pickedDate);
        this.setInputValue();
        this.closeWeekPicker();
        this.propagateWeekChanges(this.selectedWeek, this.selectedYear);
      }
    }

    // build calendar year, months and week numbers

  }, {
    key: 'buildCalendar',
    value: function buildCalendar() {
      this.destroyCalendar();
      this.buildYears();
      this.buildWeeksAndMonth();
    }

    // Clean all generated elements if user change year

  }, {
    key: 'destroyCalendar',
    value: function destroyCalendar() {
      this.prevYearNumber.innerHTML = '';
      this.prevYearWeeks.innerHTML = '';
      this.curYearNumber.innerHTML = '';
      this.curYearWeeks.innerHTML = '';
      this.nextYearNumber.innerHTML = '';
      this.nextYearWeeks.innerHTML = '';
    }
  }, {
    key: 'openWeekPicker',
    value: function openWeekPicker() {
      this.open = true;
      // Prevent on every click full redraw calendar
      this.calendar.classList.add('opened');
      this.input.classList.add('active');
      this.crossIcon.className = 'icon icon-cross';
      this.buildCalendar();
      this.highlightCurrentWeek();
    }

    // Close calendar if user don't click on calendar

  }, {
    key: 'closeWeekPicker',
    value: function closeWeekPicker() {
      this.open = false;
      this.calendar.classList.remove('opened');
      this.input.classList.remove('active');
      this.crossIcon.className = 'icon icon-calendar';
    }
  }, {
    key: 'setInputValue',
    value: function setInputValue() {
      this.input.value = this.selectedWeek + '-' + this.curYear;
    }

    // Changed year if user click left arrow button

  }, {
    key: 'moveYearBefore',
    value: function moveYearBefore() {
      this.curYear -= 1;
      this.prevYear -= 1;
      this.nextYear -= 1;
      this.buildCalendar();
      this.highlightCurrentWeek();
    }

    // Changed year if user click right arrow button

  }, {
    key: 'moveYearAfter',
    value: function moveYearAfter() {
      this.curYear += 1;
      this.prevYear += 1;
      this.nextYear += 1;
      this.buildCalendar();
      this.highlightCurrentWeek();
    }

    // Draw span with year number

  }, {
    key: 'buildYears',
    value: function buildYears() {
      this.prevYearNumber.innerHTML = '<span>' + this.prevYear + '</span>';
      var prevYearWeeksNumbers = weeksNumbersForYear(this.prevYear).slice(10);
      if (parseDate(this.prevYear, prevYearWeeksNumbers[0][0]) < parseDate(this.minYear, this.minWeek)) {
        this.prevYearButton.setAttribute('disabled', 'disabled');
        this.querySelector('.prev-year .year').setAttribute('disabled', 'disabled');
      } else {
        this.prevYearButton.removeAttribute('disabled');
        this.querySelector('.prev-year .year').removeAttribute('disabled');
      }

      this.nextYearNumber.innerHTML = '<span>' + this.nextYear + '</span>';
      var nextYearWeeksNumbers = weeksNumbersForYear(this.nextYear).slice(0, 2);
      if (parseDate(this.nextYear, nextYearWeeksNumbers[1][nextYearWeeksNumbers[1].length - 1]) > parseDate(this.maxYear, this.maxWeek)) {
        this.nextYearButton.setAttribute('disabled', 'disabled');
        this.querySelector('.next-year .year').setAttribute('disabled', 'disabled');
      } else {
        this.nextYearButton.removeAttribute('disabled');
        this.querySelector('.next-year .year').removeAttribute('disabled');
      }
      this.curYearNumber.innerHTML = '<span>' + this.curYear + '</span>';
    }

    // Draw months and week numbers

  }, {
    key: 'buildWeeksAndMonth',
    value: function buildWeeksAndMonth() {
      var _this3 = this;

      var self = this;
      this.prevYearWeeksNumbers = weeksNumbersForYear(this.prevYear).slice(10);
      // Draw month and it weeks in different spans
      this.prevYearWeeksNumbers.forEach(function (month, i) {
        _this3.prevYearWeeks.innerHTML += '<span class="weekNumbers">\n                                          <span class="month">' + self.months[i + 10] + '</span>\n                                          ' + month.map(function (week) {
          return '<span class="prevYear week" \n                                                ' + (parseDate(_this3.prevYear, week) < parseDate(_this3.minYear, _this3.minWeek) ? 'disabled="disabled"' : '') + '>\n                                                ' + week + '</span>';
        }).join('') + '\n                                          </span>\n                                       </span>';
      });
      this.curYearWeeksNumbers = weeksNumbersForYear(this.curYear);
      this.curYearWeeksNumbers.forEach(function (month, i) {
        _this3.curYearWeeks.innerHTML += '<span class="weekNumbers">\n                                          <span class="month">' + self.months[i] + '</span>\n                                          ' + month.map(function (week) {
          return '<span class="curYear week" \n                                              ' + (parseDate(_this3.curYear, week) < parseDate(_this3.minYear, _this3.minWeek) || parseDate(_this3.curYear, week) > parseDate(_this3.maxYear, _this3.maxWeek) ? 'disabled="disabled"' : '') + '>' + week + '</span>';
        }).join('') + '\n                                       </span>';
      });
      this.nextYearWeeksNumbers = weeksNumbersForYear(this.nextYear).slice(0, 2);
      this.nextYearWeeksNumbers.forEach(function (month, i) {
        _this3.nextYearWeeks.innerHTML += '<span class="weekNumbers">\n                                          <span class="month">' + self.months[i] + '</span>\n                                          ' + month.map(function (week) {
          return '<span class="nextYear week" \n                                              ' + (parseDate(_this3.nextYear, week) > parseDate(_this3.maxYear, _this3.maxWeek) ? 'disabled="disabled"' : '') + '>' + week + '</span>';
        }).join('') + '\n                                       </span>';
      });
    }

    // Highlight the current week number

  }, {
    key: 'highlightCurrentWeek',
    value: function highlightCurrentWeek() {
      var _this4 = this;

      var wholeWeeks = void 0;
      if (this.selectedYear === this.curYear) {
        wholeWeeks = this.querySelectorAll('.curYear.week');
      } else if (this.selectedYear === this.prevYear) {
        wholeWeeks = this.querySelectorAll('.prevYear.week');
      } else if (this.selectedYear === this.nextYear) {
        wholeWeeks = this.querySelectorAll('.nextYear.week');
      } else {
        return;
      }

      this.pickedWeekWrapper = Array.from(wholeWeeks).find(function (week) {
        return parseInt(week.innerHTML) === _this4.selectedWeek;
      });
      if (this.pickedWeekWrapper) {
        this.pickedWeekWrapper.classList.add('now');
      }
    }
  }, {
    key: 'getAttributes',
    value: function getAttributes() {
      var selectedYear = parseInt(this.getAttribute('year'));
      var selectedWeek = parseInt(this.getAttribute('week'));
      this.date = selectedYear && selectedWeek ? parseDate(selectedYear, selectedWeek) : new Date();
      this.parseDates(this.date);
      this.minWeek = this.getAttribute('min-week') || 1;
      this.minYear = this.getAttribute('min-year') || 0;
      this.maxWeek = this.getAttribute('max-week') || 60;
      this.maxYear = this.getAttribute('max-year') || 5000;
    }
  }, {
    key: 'parseDates',
    value: function parseDates(date) {
      this.curYear = this.selectedYear = date.getFullYear();
      this.prevYear = this.curYear - 1;
      this.nextYear = this.curYear + 1;
      this.selectedMonth = this.months[date.getMonth()];
      this.selectedWeek = getWeek(this.selectedYear, date.getMonth(), date.getDate());
    }
  }, {
    key: 'propagateWeekChanges',
    value: function propagateWeekChanges(week, year) {
      var event = new CustomEvent("change", {
        detail: {
          week: week,
          year: year
        }
      });
      this.dispatchEvent(event);
    }
  }, {
    key: 'attributeChangedCallback',
    value: function attributeChangedCallback(attrName, oldVal, newVal) {
      switch (attrName) {
        case "year":
        case "week":
        case "min-week":
        case "max-week":
        case "min-year":
        case "max-year":
          this.getAttributes();
          this.buildCalendar();
          this.setInputValue();
          break;
      }
    }
  }]);

  return WSWeekPicker;
}(HTMLElement);

//Register the element with the document


document.registerElement('ws-week-picker', WSWeekPicker);

//
// HELPERS
//
function getWeek(year, month, day) {
  var y2k = function y2k(number) {
    return number < 1000 ? number + 1900 : number;
  };
  var when = new Date(year, month, day);
  var newYear = new Date(year, 0, 1);
  var modDay = newYear.getDay();
  if (modDay == 0) modDay = 6;else modDay--;
  // Days between current day and 1st of January
  var daynum = (Date.UTC(y2k(year), when.getMonth(), when.getDate(), 0, 0, 0) - Date.UTC(y2k(year), 0, 1, 0, 0, 0)) / 1000 / 60 / 60 / 24 + 1;

  if (modDay < 4) {
    var weeknum = Math.floor((daynum + modDay - 1) / 7) + 1;
  } else {
    var weeknum = Math.floor((daynum + modDay - 1) / 7);
    if (weeknum == 0) {
      year--;
      var prevNewYear = new Date(year, 0, 1);
      var prevmodDay = prevNewYear.getDay();
      if (prevmodDay == 0) prevmodDay = 6;else prevmodDay--;
      if (prevmodDay < 4) weeknum = 53;else weeknum = 52;
    }
  }

  return weeknum;
}

function parseDate(year, week) {
  var simple = new Date(year, 0, 1 + (week - 1) * 7);
  var dow = simple.getDay();
  var ISOweekStart = simple;
  if (dow <= 4) ISOweekStart.setDate(simple.getDate() - simple.getDay() + 1);else ISOweekStart.setDate(simple.getDate() + 8 - simple.getDay());
  return ISOweekStart;
}

// Calculate all week numbers of year in January and save them in array
// January is explicitly to other months, because need to calculate first week of year
// It can be week number from previous year
function janWeekNumbers(year) {
  var firstMonthWeeks = [];
  var firstWeek = 1;
  var lastWeek = getWeek(year, 0, 31);
  if (firstWeek != 1) {
    firstMonthWeeks[0] = firstWeek;
    for (var j = 1; j <= lastWeek; j++) {
      firstMonthWeeks.push(j);
    }
  } else {
    for (var _j = 0; _j < lastWeek; _j++) {
      firstMonthWeeks.push(_j + 1);
    }
  }
  return firstMonthWeeks;
}

// Return array of all week numbers of year in month
function weekNumbersByMonth(year, month) {
  var monthWeeks = [];
  var firstWeek = getWeek(year, month, 1);
  var lastWeek = getWeek(year, month, 31);
  for (var j = firstWeek; j <= lastWeek; j++) {
    monthWeeks.push(j);
  }
  return monthWeeks;
}

// Array of all weeks in year, splited by month
function weeksNumbersForYear(year) {
  var weeks = [];
  weeks[0] = janWeekNumbers(year);
  for (var i = 1; i <= 11; i++) {
    weeks[i] = weekNumbersByMonth(year, i);
    if (weeks[i - 1][weeks[i - 1].length - 1] === weeks[i][0]) {
      weeks[i] = weeks[i].slice(1);
    }
  }
  return weeks;
}
    function applyTemplate(containerElem, template) {
	'use strict';

	addLightDom(containerElem, template);

	var innerContainerSelector = '.' + containerElem.tagName.toLowerCase();

	var observer = new MutationObserver(function(mutations) {
		var changed = false;
		mutations.forEach(function(mutation) {
			var target = mutation.target;
			if (target === containerElem) {
				return;
			}
			if (target instanceof Text) {
				// text elements have no closest function
				target = target.parentNode;
			}
			// ignore changes inside of pseudo shadow dom
			if(target.closest(innerContainerSelector)) {
				return;
			}

			// console.log('Mutation:', mutation);
			changed = true;
		});

		if (changed) {
			addLightDom(containerElem, containerElem.querySelector(innerContainerSelector));
		}
	});

	// Konfiguration des Observers: alles melden - Änderungen an Daten, Kindelementen und Attributen
	var config = {
		attributes: true,
		childList: true,
		characterData: true,
		subtree:true
	};

	observer.observe(containerElem, config);
}

function addLightDom(containerElem, template) {
	'use strict';

	var innerContainerSelector = '.' + containerElem.tagName.toLowerCase();

	let contentTags = template.querySelectorAll('content');
	Array.from(contentTags).forEach(contentTag => {
		contentTag.innerHTML = '';
		let selection = contentTag.getAttribute('select');
		if (selection) {
			let selectedLightDomElems = Array.from(containerElem.querySelectorAll(selection))
				.filter(elem => !elem.closest(innerContainerSelector));

			selectedLightDomElems.forEach(selectedLightDomElem => {
				var clone = selectedLightDomElem.cloneNode(true);
				contentTag.appendChild(clone);
			});
		}
	});

	var lightDom = Array.from(containerElem.children).filter(elem => {
		return elem.classList
			&& !elem.classList.contains(innerContainerSelector.substr(1));
	});
	for(var child of lightDom) {
		if (!child.classList.contains('light-dom')) {
			child.classList.add('light-dom');
		}
	}

	containerElem.appendChild(template);
}

    /* endinject */
})()
</script>
